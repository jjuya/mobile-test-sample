<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>반응형 달력 모달 (뷰 전환 지원)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ----------------------------------------------------- */
        /* 기본 레이아웃 및 뷰 전환 스타일 */
        /* ----------------------------------------------------- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #5c6470;
            display: flex;
            flex-direction: column; /* 버튼과 프레임을 세로로 배치 */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .view-controls {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
        }

        /* 디바이스 프레임 공통 스타일 */
        .phone-frame {
            position: relative;
            width: 375px; /* 모바일 뷰 기본 너비 */
            height: 667px;
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid #5c6470;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease-in-out; /* 너비/높이 전환 애니메이션 */
        }

        /* 태블릿 뷰 프레임 오버라이드 */
        .tablet-view .phone-frame {
            width: 768px; /* 태블릿 뷰 너비로 확장 */
            height: 667px; 
        }

        .phone-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }
        
        /* ----------------------------------------------------- */
        /* 팝업 공통 스타일 (모바일: 하단 슬라이드 업, 태블릿: 중앙 모달) */
        /* ----------------------------------------------------- */
        .mobile-popup-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: flex-end; /* 모바일: 하단에 배치 */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
        }

        .mobile-popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .calendar-container {
            width: 100%;
            max-width: 400px; /* 모바일 뷰 최대 너비 */
            background-color: #fff;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            box-shadow: 0 -10px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transform: translateY(100%); /* 하단 숨김 */
            transition: transform 0.3s ease-in-out;
        }

        .mobile-popup-overlay.show .calendar-container {
            transform: translateY(0); /* 슬라이드 업 */
        }
        
        /* ----------------------------------------------------- */
        /* [태블릿 뷰] 오버라이드 (중앙 모달 및 크기 조정) */
        /* ----------------------------------------------------- */
        .tablet-view .mobile-popup-overlay {
            align-items: center; /* 태블릿: 팝업을 중앙에 배치 */
        }

        .tablet-view .calendar-container {
            max-width: 600px; /* 태블릿 뷰 최대 너비 */
            height: auto; /* 내용에 맞춰 높이 자동 조정 */
            border-radius: 0.5rem; /* 모서리 둥글게 */
        }
        
        .tablet-view .mobile-popup-overlay.show .calendar-container {
             /* 태블릿 뷰에서는 중앙 배치만 하면 되므로 transform은 그대로 둠 */
        }

        /* ----------------------------------------------------- */
        /* 달력 컴포넌트 스타일 */
        /* ----------------------------------------------------- */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .month-year-display {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .day-names {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            padding: 0.5rem 0;
            background-color: #f9fafb;
            font-size: 0.875rem;
            color: #4b5563;
        }
        .day-names > div {
            padding: 0.5rem 0;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            padding: 0.5rem;
        }

        /* 개별 날짜 버튼 스타일 */
        .day-cell {
            padding: 0.25rem;
            cursor: pointer;
        }
        .day-button {
            width: 2.25rem;
            height: 2.25rem;
            line-height: 2.25rem;
            border-radius: 9999px; /* 원형 */
            font-weight: 500;
            display: inline-block;
            transition: background-color 0.1s;
        }
        
        /* 현재 월에 속하지 않는 날짜 */
        .day-cell.other-month .day-button {
            color: #9ca3af;
        }

        /* hover 효과 */
        .day-cell:not(.selected) .day-button:not(.other-month):hover {
            background-color: #e5e7eb;
        }

        /* 오늘 날짜 */
        .day-cell.today .day-button {
            color: #3b82f6;
            font-weight: 700;
            border: 1px solid #3b82f6;
        }

        /* 선택된 날짜 */
        .day-cell.selected .day-button {
            background-color: #3b82f6;
            color: #fff;
            font-weight: 700;
            border: 1px solid #3b82f6;
        }

        /* 하단 액션 버튼 영역 */
        .action-buttons {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end; /* 오른쪽 정렬 */
        }
        .action-button { 
            padding: 0.5rem 1rem; 
            border-radius: 0.5rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: background-color 0.2s; 
        }
        .action-button.cancel { 
            background-color: #f3f4f6; 
            color: #4b5563; 
        }
        .action-button.cancel:hover { 
            background-color: #e5e7eb; 
        }
        .action-button.confirm { 
            background-color: #3b82f6; 
            color: #fff; 
        }
        .action-button.confirm:hover { 
            background-color: #2563eb; 
        }
    </style>
</head>
<body id="appBody" class="mobile-view"> 

    <div class="view-controls">
        <button id="mobileViewButton" class="px-4 py-2 rounded-md font-semibold text-white bg-blue-500 hover:bg-blue-600">
            모바일 뷰 (375px)
        </button>
        <button id="tabletViewButton" class="px-4 py-2 rounded-md font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300">
            태블릿 뷰 (768px)
        </button>
    </div>

    <div class="phone-frame" id="phoneFrame">
        <div class="phone-content">
            <h1 class="text-xl font-bold text-center text-gray-800">반응형 단일 날짜 선택 달력</h1>
            <p class="text-sm text-center text-gray-500 mt-2">아래 입력창을 터치하여 날짜를 선택하세요.</p>
            <div class="relative w-full max-w-xs" id="triggerWrapper">
                <input type="text" id="triggerInput" class="rounded-lg p-3 pr-10 text-lg text-gray-700 w-full cursor-pointer focus:outline-none border border-gray-300" placeholder="날짜를 선택하세요" readonly>
                <svg class="w-5 h-5 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
            </div>
        </div>
        
        <div class="mobile-popup-overlay" id="popupOverlay">
            <div class="calendar-container">
                
                <div class="calendar-header">
                    <button id="prevMonth" class="p-2 rounded-full hover:bg-gray-100 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <div id="monthYearDisplay" class="month-year-display"></div>
                    <button id="nextMonth" class="p-2 rounded-full hover:bg-gray-100 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>

                <div class="day-names">
                    <div>일</div>
                    <div>월</div>
                    <div>화</div>
                    <div>수</div>
                    <div>목</div>
                    <div>금</div>
                    <div>토</div>
                </div>

                <div id="daysGrid" class="days-grid">
                    </div>

                <div class="action-buttons">
                    <button id="cancelButton" class="action-button cancel">취소</button>
                    <button id="confirmButton" class="action-button confirm" disabled>확인</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM 요소 참조
            const appBody = document.getElementById('appBody');
            const triggerInput = document.getElementById('triggerInput');
            const popupOverlay = document.getElementById('popupOverlay');
            const monthYearDisplay = document.getElementById('monthYearDisplay');
            const daysGrid = document.getElementById('daysGrid');
            const prevMonthButton = document.getElementById('prevMonth');
            const nextMonthButton = document.getElementById('nextMonth');
            const cancelButton = document.getElementById('cancelButton');
            const confirmButton = document.getElementById('confirmButton');
            const mobileButton = document.getElementById('mobileViewButton');
            const tabletButton = document.getElementById('tabletViewButton');
            
            // 상태 변수
            let currentDate = new Date(); // 현재 달력을 표시할 기준 날짜
            let selectedDate = null; // 사용자가 임시로 선택한 날짜 (Date 객체)
            let committedDate = null; // 최종적으로 확정된 날짜 (취소 시 복원용)
            let currentView = 'mobile'; // 현재 뷰 상태

            // 날짜 포맷터
            const dateFmt = new Intl.DateTimeFormat('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' }).format;

            // --- 뷰 전환 로직 ---

            // 뷰를 설정하고 UI를 업데이트하는 함수
            function setView(view) {
                if (view === 'tablet') {
                    appBody.classList.remove('mobile-view');
                    appBody.classList.add('tablet-view');
                    
                    // 버튼 스타일 업데이트
                    tabletButton.classList.replace('bg-gray-200', 'bg-blue-500');
                    tabletButton.classList.replace('text-gray-700', 'text-white');
                    mobileButton.classList.replace('bg-blue-500', 'bg-gray-200');
                    mobileButton.classList.replace('text-white', 'text-gray-700');
                    
                    currentView = 'tablet';
                } else { // mobile
                    appBody.classList.remove('tablet-view');
                    appBody.classList.add('mobile-view');
                    
                    // 버튼 스타일 업데이트
                    mobileButton.classList.replace('bg-gray-200', 'bg-blue-500');
                    mobileButton.classList.replace('text-gray-700', 'text-white');
                    tabletButton.classList.replace('bg-blue-500', 'bg-gray-200');
                    tabletButton.classList.replace('text-white', 'text-gray-700');

                    currentView = 'mobile';
                }
                
                // 뷰 전환 시 팝업이 열려 있었다면 닫기
                if (popupOverlay.classList.contains('show')) {
                    popupOverlay.classList.remove('show');
                }
            }
            
            // 뷰 전환 버튼 이벤트 리스너
            mobileButton.addEventListener('click', () => setView('mobile'));
            tabletButton.addEventListener('click', () => setView('tablet'));
            
            // --- 달력 렌더링 및 로직 ---

            // 날짜를 'YYYY-MM-DD' 형식의 문자열로 변환
            function formatDate(date) {
                if (!date) return null;
                const y = date.getFullYear();
                const m = String(date.getMonth() + 1).padStart(2, '0');
                const d = String(date.getDate()).padStart(2, '0');
                return `${y}-${m}-${d}`;
            }
            
            // 두 날짜가 같은지 확인 (날짜, 월, 년도만 비교)
            function isSameDay(d1, d2) {
                return d1 && d2 && d1.getFullYear() === d2.getFullYear() && 
                       d1.getMonth() === d2.getMonth() && 
                       d1.getDate() === d2.getDate();
            }

            // 달력 렌더링 함수
            function renderCalendar() {
                daysGrid.innerHTML = '';
                
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                
                // 월/년도 표시 업데이트
                monthYearDisplay.textContent = `${year}년 ${month + 1}월`;

                // 해당 월의 첫 날과 마지막 날
                const firstDayOfMonth = new Date(year, month, 1);
                const lastDayOfMonth = new Date(year, month + 1, 0);
                
                // 달력에 표시될 첫 날 (지난 달 날짜부터 시작)
                // getDay(): 일요일(0) ~ 토요일(6)
                const startDayIndex = firstDayOfMonth.getDay(); 
                const startDate = new Date(firstDayOfMonth);
                startDate.setDate(startDate.getDate() - startDayIndex); // 캘린더 시작 날짜

                const today = new Date(); // 오늘 날짜

                // 총 6주를 표시하기 위한 반복 (최대 42일)
                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    
                    const day = date.getDate();
                    const currentMonth = date.getMonth();
                    const dateString = formatDate(date);

                    const isToday = isSameDay(date, today);
                    const isSelected = isSameDay(date, selectedDate);
                    const isOtherMonth = currentMonth !== month;

                    const dayCell = document.createElement('div');
                    dayCell.className = 'day-cell';
                    if (isSelected) dayCell.classList.add('selected');
                    if (isToday) dayCell.classList.add('today');
                    if (isOtherMonth) dayCell.classList.add('other-month');

                    // 날짜 버튼 생성
                    const dayButton = document.createElement('span');
                    dayButton.className = 'day-button';
                    dayButton.textContent = day;
                    dayButton.setAttribute('data-date', dateString);
                    dayButton.setAttribute('data-month', currentMonth);

                    // 클릭 이벤트 리스너 추가
                    dayButton.addEventListener('click', () => {
                        // 다른 달 날짜 클릭 시 해당 달로 이동
                        if (isOtherMonth) {
                            currentDate = date; // 현재 기준 날짜 변경
                            // selectedDate는 클릭한 날짜로 업데이트 후
                            selectedDate = date;
                            renderCalendar(); // 새 달력 렌더링
                        } else {
                            // 같은 달 날짜 클릭 시 선택 상태 토글/변경
                            if (isSelected) {
                                // 이미 선택된 날짜를 다시 클릭하면 선택 해제 (단일 선택이므로 사실상 불필요)
                                selectedDate = null;
                            } else {
                                // 새로운 날짜 선택
                                selectedDate = date;
                            }
                            // UI 업데이트
                            updateSelectionUI();
                        }
                        updateConfirmButtonState();
                    });

                    dayCell.appendChild(dayButton);
                    daysGrid.appendChild(dayCell);
                    
                    // 현재 월의 마지막 날을 초과하고, 토요일이 끝났다면 반복 중단 (깔끔한 캘린더 모양 유지)
                    if (currentMonth > month && date.getDay() === 6) {
                         // break; // 이 부분은 6주 전체를 보여주기 위해 주석 처리
                    }
                }
            }
            
            // 날짜 선택 시 UI만 업데이트 (렌더링 전체를 다시 하지 않고 효율적으로)
            function updateSelectionUI() {
                document.querySelectorAll('.day-cell').forEach(cell => {
                    cell.classList.remove('selected');
                });

                if (selectedDate) {
                    const selectedDateString = formatDate(selectedDate);
                    // data-date 속성을 사용하여 선택된 날짜 찾기
                    const selectedButton = daysGrid.querySelector(`[data-date="${selectedDateString}"]`);
                    if (selectedButton) {
                        selectedButton.closest('.day-cell').classList.add('selected');
                    }
                }
            }
            
            // 확인 버튼 활성화/비활성화 상태 업데이트
            function updateConfirmButtonState() {
                confirmButton.disabled = !selectedDate;
            }

            // 이전 달로 이동
            prevMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            // 다음 달로 이동
            nextMonthButton.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            // 팝업 열기
            triggerInput.addEventListener('click', (event) => {
                // 팝업 열기 전에 현재 확정된 날짜를 임시 저장
                committedDate = selectedDate; 
                
                // 달력의 현재 기준 날짜를 확정된 날짜로 설정 (혹은 오늘 날짜)
                currentDate = committedDate ? new Date(committedDate) : new Date();
                
                // 달력 렌더링
                renderCalendar(); 
                updateConfirmButtonState();
                
                popupOverlay.classList.add('show');
                event.stopPropagation();
            });
            
            // 팝업 닫기 (오버레이 클릭 시 또는 ESC 키) - 취소 기능
            popupOverlay.addEventListener('click', (event) => {
                if (event.target.id === 'popupOverlay' || event.target.id === 'cancelButton') {
                    if (popupOverlay.classList.contains('show')) {
                        // 임시 저장된 항목으로 복원 (취소 기능)
                        selectedDate = committedDate; 
                        
                        // 달력 UI 복원 (복원된 날짜가 포함된 달로 이동)
                        currentDate = committedDate ? new Date(committedDate) : new Date();
                        renderCalendar();
                        updateSelectionUI();
                        updateConfirmButtonState();
                        
                        popupOverlay.classList.remove('show');
                    }
                }
            });
            
            // ESC 키 입력 시 팝업 닫기 및 복원
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && popupOverlay.classList.contains('show')) {
                    // 임시 저장된 항목으로 복원
                    selectedDate = committedDate; 
                    
                    // 달력 UI 복원
                    currentDate = committedDate ? new Date(committedDate) : new Date();
                    renderCalendar();
                    updateSelectionUI();
                    updateConfirmButtonState();
                    
                    popupOverlay.classList.remove('show');
                }
            });

            // 확인 버튼 (팝업 닫기 기능 및 값 전달)
            confirmButton.addEventListener('click', () => {
                if (selectedDate) {
                    const selectedString = dateFmt(selectedDate);
                    triggerInput.value = selectedString; // 입력창 업데이트
                    committedDate = selectedDate; // 최종 확정
                }
                popupOverlay.classList.remove('show');
            });

            // 초기 뷰 설정 및 달력 렌더링
            setView('mobile');
            renderCalendar();
        });
    </script>
</body>
</html>