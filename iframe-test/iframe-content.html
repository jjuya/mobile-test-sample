<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>iframe Î™®Îçò UI + ÌÇ§Î≥¥Îìú scroll</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap");

            html,
            body {
                margin: 0;
                padding: 0;
                font-family: "Inter", sans-serif;
                background: #f4f6f8;
                display: flex;
                flex-direction: column;
                align-items: center;
                min-height: 100vh;
            }

            .container {
                width: 90%;
                max-width: 480px;
                margin-top: 40px;
                display: flex;
                flex-direction: column;
                gap: 24px;
            }

            .input-group {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }
            .input-group label {
                font-size: 14px;
                color: #6b7280;
            }
            .input-group input {
                padding: 14px 16px;
                font-size: 16px;
                border-radius: 12px;
                border: 1px solid #d1d5db;
                background: #ffffff;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
                outline: none;
                transition: all 0.2s ease;
            }
            .input-group input:focus {
                border-color: #3b82f6;
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            }

            button {
                padding: 14px;
                font-size: 16px;
                border-radius: 12px;
                border: none;
                cursor: pointer;
                background: #3b82f6;
                color: white;
                font-weight: 500;
                transition: all 0.2s ease;
            }
            button:hover {
                background: #2563eb;
            }

            .popup-bg {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(31, 41, 55, 0.25);
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
                z-index: 998;
            }
            .popup-bg.active {
                opacity: 1;
                pointer-events: all;
            }

            .popup {
                position: fixed;
                left: 50%;
                bottom: -100%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 480px;
                height: 360px;
                background: #ffffff;
                border-radius: 20px 20px 0 0;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
                display: flex;
                flex-direction: column;
                padding: 24px;
                gap: 16px;
                transition: bottom 0.3s ease;
                overflow-y: auto;
                z-index: 999;
            }
            .popup.active {
                bottom: 0;
            }

            .popup h4 {
                margin: 0;
                color: #111827;
                font-weight: 500;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="input-group">
                <label for="name">Ïù¥Î¶Ñ</label>
                <input id="name" type="text" placeholder="ÌôçÍ∏∏Îèô" />
            </div>

            <div class="input-group">
                <label for="email">Ïù¥Î©îÏùº</label>
                <input
                    id="email"
                    type="email"
                    placeholder="example@gmail.com"
                />
            </div>

            <div class="input-group">
                <label for="phone">Ï†ÑÌôîÎ≤àÌò∏</label>
                <input
                    id="phone"
                    type="tel"
                    placeholder="010-1234-5678"
                    inputmode="numeric"
                />
            </div>

            <div class="input-group">
                <label for="address">Ï£ºÏÜå</label>
                <input
                    id="address"
                    type="text"
                    placeholder="ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ..."
                />
            </div>

            <button id="openPopup">ÌïòÎã® ÌåùÏóÖ Ïó¥Í∏∞</button>
        </div>

        <div class="popup-bg" id="popupBg"></div>

        <div class="popup" id="popup">
            <h4>üìã ÌåùÏóÖ ÎÇ¥Î∂Ä</h4>

            <div class="input-group">
                <label for="popup1">ÌåùÏóÖ Ïù¥Î¶Ñ</label>
                <input id="popup1" type="text" placeholder="ÌôçÍ∏∏Îèô" />
            </div>
            <div class="input-group">
                <label for="popup2">ÌåùÏóÖ Ïù¥Î©îÏùº</label>
                <input
                    id="popup2"
                    type="email"
                    placeholder="example@gmail.com"
                />
            </div>
            <div class="input-group">
                <label for="popup3">ÌåùÏóÖ Ï†ÑÌôîÎ≤àÌò∏</label>
                <input
                    id="popup3"
                    type="tel"
                    placeholder="010-1234-5678"
                    inputmode="numeric"
                />
            </div>
            <div class="input-group">
                <label for="popup4">ÌåùÏóÖ Ï£ºÏÜå</label>
                <input
                    id="popup4"
                    type="text"
                    placeholder="ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ..."
                />
            </div>

            <button id="closePopup">Îã´Í∏∞</button>
        </div>

        <script>
            const popup = document.getElementById("popup");
            const popupBg = document.getElementById("popupBg");
            const btnOpen = document.getElementById("openPopup");
            const btnClose = document.getElementById("closePopup");
            const inputs = document.querySelectorAll("input");
            let currentInput = null;
            const inputValues = {};

            let rAFId = null;

            // ÌåùÏóÖ Ïó¥Í∏∞/Îã´Í∏∞
            btnOpen.addEventListener("click", () => {
                popup.classList.add("active");
                popupBg.classList.add("active");
            });
            btnClose.addEventListener("click", closePopup);
            popupBg.addEventListener("click", closePopup);
            function closePopup() {
                popup.classList.remove("active");
                popupBg.classList.remove("active");
            }

            // input Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
            inputs.forEach((input) => {
                input.addEventListener("focus", () => {
                    currentInput = input;
                    if (rAFId) cancelAnimationFrame(rAFId);

                    const adjustScrollLoop = () => {
                        if (!currentInput) return;
                        adjustScroll(currentInput);
                        // viewportÍ∞Ä ÏïàÏ†ïÎê† ÎïåÍπåÏßÄ Îã§Ïùå ÌîÑÎ†àÏûÑÏóêÏÑú Ïû¨Ìò∏Ï∂ú
                        rAFId = requestAnimationFrame(adjustScrollLoop);
                    };

                    rAFId = requestAnimationFrame(adjustScrollLoop);
                });

                input.addEventListener("blur", () => {
                    currentInput = null;
                    if (rAFId) cancelAnimationFrame(rAFId);
                });

                input.addEventListener("input", () => {
                    if (input.type === "tel")
                        input.value = input.value.replace(/[^\d-]/g, "");
                    inputValues[input.id] = input.value;
                });
            });

            // visualViewport Í∞êÏßÄ
            if (window.visualViewport) {
                window.visualViewport.addEventListener("resize", () => {
                    if (currentInput) adjustScroll(currentInput);
                });
                window.visualViewport.addEventListener("scroll", () => {
                    if (currentInput) adjustScroll(currentInput);
                });
            }

            function adjustScroll(targetInput) {
                if (!targetInput) return;
                const rect = targetInput.getBoundingClientRect();
                const viewport = window.visualViewport;
                const isInPopup = popup.contains(targetInput);

                if (isInPopup) {
                    const targetScroll =
                        popup.scrollTop + rect.top - viewport.height / 2;
                    popup.scrollTo({ top: targetScroll, behavior: "smooth" });
                } else {
                    const offsetTop = rect.top + window.scrollY;
                    const targetY =
                        offsetTop - viewport.height / 2 + rect.height;
                    window.scrollTo({ top: targetY, behavior: "smooth" });
                }
            }

            function isIOS() {
                return /iPhone|iPad|iPod/i.test(navigator.userAgent);
            }
        </script>
    </body>
</html>
