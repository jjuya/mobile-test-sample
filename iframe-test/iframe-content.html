<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>iframe ëª¨ë˜ UI + í‚¤ë³´ë“œ scroll</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap");

            html,
            body {
                margin: 0;
                padding: 0;
                font-family: "Inter", sans-serif;
                background: #f4f6f8;
                display: flex;
                flex-direction: column;
                align-items: center;
                min-height: 100vh;
            }

            .container {
                width: 90%;
                max-width: 480px;
                margin-top: 40px;
                display: flex;
                flex-direction: column;
                gap: 24px;
            }

            .input-group {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }
            .input-group label {
                font-size: 14px;
                color: #6b7280;
            }
            .input-group input {
                padding: 14px 16px;
                font-size: 16px;
                border-radius: 12px;
                border: 1px solid #d1d5db;
                background: #ffffff;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
                outline: none;
                transition: all 0.2s ease;
            }
            .input-group input:focus {
                border-color: #3b82f6;
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            }

            button {
                padding: 14px;
                font-size: 16px;
                border-radius: 12px;
                border: none;
                cursor: pointer;
                background: #3b82f6;
                color: white;
                font-weight: 500;
                transition: all 0.2s ease;
            }
            button:hover {
                background: #2563eb;
            }

            .popup-bg {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(31, 41, 55, 0.25);
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
                z-index: 998;
            }
            .popup-bg.active {
                opacity: 1;
                pointer-events: all;
            }

            .popup {
                position: fixed;
                left: 50%;
                bottom: -100%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 480px;
                height: 360px;
                background: #ffffff;
                border-radius: 20px 20px 0 0;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
                display: flex;
                flex-direction: column;
                padding: 24px;
                gap: 16px;
                transition: bottom 0.3s ease;
                overflow-y: auto;
                z-index: 999;
            }
            .popup.active {
                bottom: 0;
            }

            .popup h4 {
                margin: 0;
                color: #111827;
                font-weight: 500;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="input-group">
                <label for="name">ì´ë¦„</label>
                <input id="name" type="text" placeholder="í™ê¸¸ë™" />
            </div>

            <div class="input-group">
                <label for="email">ì´ë©”ì¼</label>
                <input
                    id="email"
                    type="email"
                    placeholder="example@gmail.com"
                />
            </div>

            <div class="input-group">
                <label for="phone">ì „í™”ë²ˆí˜¸</label>
                <input
                    id="phone"
                    type="tel"
                    placeholder="010-1234-5678"
                    inputmode="numeric"
                />
            </div>

            <div class="input-group">
                <label for="address">ì£¼ì†Œ</label>
                <input
                    id="address"
                    type="text"
                    placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ..."
                />
            </div>

            <button id="openPopup">í•˜ë‹¨ íŒì—… ì—´ê¸°</button>
        </div>

        <div class="popup-bg" id="popupBg"></div>

        <div class="popup" id="popup">
            <h4>ğŸ“‹ íŒì—… ë‚´ë¶€</h4>

            <div class="input-group">
                <label for="popup1">íŒì—… ì´ë¦„</label>
                <input id="popup1" type="text" placeholder="í™ê¸¸ë™" />
            </div>
            <div class="input-group">
                <label for="popup2">íŒì—… ì´ë©”ì¼</label>
                <input
                    id="popup2"
                    type="email"
                    placeholder="example@gmail.com"
                />
            </div>
            <div class="input-group">
                <label for="popup3">íŒì—… ì „í™”ë²ˆí˜¸</label>
                <input
                    id="popup3"
                    type="tel"
                    placeholder="010-1234-5678"
                    inputmode="numeric"
                />
            </div>
            <div class="input-group">
                <label for="popup4">íŒì—… ì£¼ì†Œ</label>
                <input
                    id="popup4"
                    type="text"
                    placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ..."
                />
            </div>

            <button id="closePopup">ë‹«ê¸°</button>
        </div>

        <script>
            const popup = document.getElementById("popup");
            const popupBg = document.getElementById("popupBg");
            const btnOpen = document.getElementById("openPopup");
            const btnClose = document.getElementById("closePopup");
            const inputs = document.querySelectorAll("input");

            const inputValues = {};

            let currentInput = null;
            let rAFId = null;

            // íŒì—… ì—´ê¸°/ë‹«ê¸°
            btnOpen.addEventListener("click", () => {
                popup.classList.add("active");
                popupBg.classList.add("active");
            });
            btnClose.addEventListener("click", closePopup);
            popupBg.addEventListener("click", closePopup);
            function closePopup() {
                popup.classList.remove("active");
                popupBg.classList.remove("active");
            }

            // input ì´ë²¤íŠ¸ ì²˜ë¦¬
            inputs.forEach((input) => {
                input.addEventListener("focus", () => {
                    currentInput = input;

                    if (rAFId) cancelAnimationFrame(rAFId);

                    const loop = () => {
                        if (!currentInput) return;

                        // popup ì•ˆ/ë°– êµ¬ë¶„ ì—†ì´ scroll ì¡°ì •
                        const rect = currentInput.getBoundingClientRect();
                        const viewportHeight = window.visualViewport
                            ? window.visualViewport.height
                            : window.innerHeight;
                        const isInPopup = popup.contains(currentInput);

                        if (isInPopup) {
                            const targetScroll =
                                popup.scrollTop + rect.top - viewportHeight / 2;
                            popup.scrollTo({
                                top: targetScroll,
                                behavior: "smooth",
                            });
                        } else {
                            const offsetTop = rect.top + window.scrollY;
                            const targetY =
                                offsetTop - viewportHeight / 2 + rect.height;
                            window.scrollTo({
                                top: targetY,
                                behavior: "smooth",
                            });
                        }

                        rAFId = requestAnimationFrame(loop);
                    };

                    rAFId = requestAnimationFrame(loop);
                });

                input.addEventListener("blur", () => {
                    currentInput = null;
                    if (rAFId) cancelAnimationFrame(rAFId);
                });
            });

            function adjustScroll(targetInput) {
                if (!targetInput) return;
                const rect = targetInput.getBoundingClientRect();
                const viewport = window.visualViewport;
                const isInPopup = popup.contains(targetInput);

                if (isInPopup) {
                    const targetScroll =
                        popup.scrollTop + rect.top - viewport.height / 2;
                    popup.scrollTo({ top: targetScroll, behavior: "smooth" });
                } else {
                    const offsetTop = rect.top + window.scrollY;
                    const targetY =
                        offsetTop - viewport.height / 2 + rect.height;
                    window.scrollTo({ top: targetY, behavior: "smooth" });
                }
            }

            // visualViewport ê°ì§€
            if (window.visualViewport) {
                window.visualViewport.addEventListener("resize", () => {
                    if (currentInput) adjustScroll(currentInput);
                });
                window.visualViewport.addEventListener("scroll", () => {
                    if (currentInput) adjustScroll(currentInput);
                });
            }

            function isIOS() {
                return /iPhone|iPad|iPod/i.test(navigator.userAgent);
            }
        </script>
    </body>
</html>
