<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>VisualViewport Fixed Bottom Test</title>
        <style>
            /* 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° Fixed ìš”ì†Œ ìŠ¤íƒ€ì¼ */
            body {
                margin: 0;
                padding: 0;
                /* bodyì˜ ë†’ì´ë¥¼ ì¶©ë¶„íˆ í™•ë³´í•˜ì—¬ ìŠ¤í¬ë¡¤ì´ ë°œìƒí•˜ë„ë¡ í•©ë‹ˆë‹¤. */
                min-height: 200vh;
                background-color: #f4f4f4;
            }

            /* Fixed Bottom Menu: í‚¤ë³´ë“œ ìœ„ì— ë…¸ì¶œë˜ì–´ì•¼ í•˜ëŠ” ìš”ì†Œ */
            #fixed-bottom-menu {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 50px;
                background-color: #007bff;
                color: white;
                text-align: center;
                line-height: 50px;
                font-weight: bold;
                z-index: 999; /* í•­ìƒ ìµœìƒìœ„ì— ìœ„ì¹˜ */
            }

            /* 2. ì½˜í…ì¸  ë˜í¼ ìŠ¤íƒ€ì¼ (í•µì‹¬ ìš”ì†Œ) */
            #viewportwrap {
                position: absolute; /* Fixed ìš”ì†Œì™€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ absolute ì‚¬ìš© */
                top: 0;
                left: 0;
                width: 100%;
                height: 100%; /* ì´ˆê¸° ë†’ì´ëŠ” 100% */
                background-color: white;
                /* JavaScriptê°€ í‚¤ë³´ë“œ ON ì‹œ ì´ ì˜ì—­ì˜ heightë¥¼ visualViewport.heightë¡œ ë³€ê²½í•˜ê³ ,
               ìŠ¤í¬ë¡¤ ì‹œ transform: translateYë¥¼ ì ìš©í•©ë‹ˆë‹¤. */
                will-change: transform; /* ì„±ëŠ¥ ìµœì í™” */
                transition: transform 0s; /* ë¶€ë“œëŸ¬ìš´ ì›€ì§ì„ì„ ìœ„í•´ í•„ìš”í•  ìˆ˜ ìˆì§€ë§Œ, ì—¬ê¸°ì„œëŠ” 0së¡œ ì„¤ì •í•˜ì—¬ ì¦‰ê° ë°˜ì‘ */
            }

            /* 3. ì½˜í…ì¸  ìŠ¤íƒ€ì¼ (ìŠ¤í¬ë¡¤ í™•ì¸ìš©) */
            .content-area {
                padding: 20px;
            }

            .content-area h2 {
                margin-top: 50px;
            }
        </style>
    </head>
    <body>
        <div id="viewportwrap">
            <div class="content-area">
                <h1>ì›¹ë·° Fixed ìš”ì†Œ í…ŒìŠ¤íŠ¸</h1>
                <p>
                    ì´ í˜ì´ì§€ëŠ” ëª¨ë°”ì¼ ì›¹ë·°ì—ì„œ ê°€ìƒ í‚¤ë³´ë“œê°€ ì—´ë ¸ì„ ë•Œ
                    position: fixed; bottom: 0; ìš”ì†Œê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ë„ë¡
                    VisualViewport APIë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.
                </p>

                <h2>ìŠ¤í¬ë¡¤ì„ ìœ„í•œ ê¸´ ì½˜í…ì¸  ì˜ì—­</h2>
                <p>ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ì„œ ì½˜í…ì¸ ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                <p>
                    í‚¤ë³´ë“œê°€ ì˜¬ë¼ì˜¤ë©´ í•˜ë‹¨ Fixed ë©”ë‰´ê°€ í‚¤ë³´ë“œ ìœ„ì— ìœ„ì¹˜í•´ì•¼
                    í•©ë‹ˆë‹¤.
                </p>

                <input
                    type="text"
                    placeholder="ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì—¬ í‚¤ë³´ë“œë¥¼ ì—´ì–´ë³´ì„¸ìš”."
                    style="width: 90%; padding: 10px; margin: 50px 0"
                />

                <h2>Additional Content 1</h2>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. ...
                </p>
                <h2>Additional Content 2</h2>
                <p>
                    Sed do eiusmod tempor incididunt ut labore et dolore magna
                    aliqua. ...
                </p>
                <h2>Additional Content 3</h2>
                <p>
                    Ut enim ad minim veniam, quis nostrud exercitation ullamco
                    laboris. ...
                </p>
                <h2>Additional Content 4</h2>
                <p>
                    Duis aute irure dolor in reprehenderit in voluptate velit
                    esse cillum. ...
                </p>
                <h2>Additional Content 5</h2>
                <p>
                    Excepteur sint occaecat cupidatat non proident, sunt in
                    culpa qui officia. ...
                </p>

                <p style="height: 400px"></p>
                <p>ìŠ¤í¬ë¡¤ ë ë¶€ë¶„</p>
            </div>
        </div>

        <div id="fixed-bottom-menu">
            Fixed Bottom Menu: í‚¤ë³´ë“œ ìœ„ì— ìœ„ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
        </div>

        <script>
            // ğŸš© DOM ìš”ì†Œ
            const viewportwrap = document.getElementById("viewportwrap");

            // --- 1. OS ì²´í¬ í•¨ìˆ˜ (ê°„ë‹¨ ì˜ˆì‹œ) ---
            function checkOS() {
                const userAgent =
                    navigator.userAgent || navigator.vendor || window.opera;
                if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                    return "iOS";
                }
                // Android Chromeì„ íŠ¹ì •í•˜ì—¬ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë¸”ë¡œê·¸ì˜ ê²°ë¡ ì´ì—ˆìŠµë‹ˆë‹¤.
                if (/android/i.test(userAgent) && /chrome/i.test(userAgent)) {
                    return "AndroidChrome";
                }
                return "Other";
            }

            const currentOS = checkOS();
            console.log(`Current OS detected: ${currentOS}`);

            // --- 2. í”Œë«í¼ë³„ ìŠ¤í¬ë¡¤ í•¸ë“¤ëŸ¬ ---

            // âœ… iOS í™˜ê²½ ìŠ¤í¬ë¡¤ í•¸ë“¤ëŸ¬ (Window Scroll + ê°€ìƒ ì˜ì—­ ë°©ì§€)
            function handleWindowScroll_iOS() {
                // window.scrollYì™€ visualViewportì˜ ì°¨ì´ë¥¼ í™œìš©í•˜ì—¬ translateY ê°’ ê³„ì‚°
                let viewportTopGap = parseInt(
                    visualViewport.pageTop - visualViewport.offsetTop
                );
                let translateY = parseInt(window.scrollY - viewportTopGap);

                // ìŠ¤í¬ë¡¤ì— ë”°ë¼ viewportwrap ì´ë™
                viewportwrap.style.transform = `translateY(${translateY}px)`;

                // â›”ï¸ í•˜ë‹¨ ê°€ìƒ ì˜ì—­ê¹Œì§€ ìŠ¤í¬ë¡¤ë˜ëŠ” ê²ƒì„ ë°©ì§€
                const bodyHeight = document.body.offsetHeight;
                const viewportH = visualViewport.height;

                if (window.scrollY + viewportH > bodyHeight - 2) {
                    // ìŠ¤í¬ë¡¤ì„ ì œí•œí•˜ì—¬ ê°€ìƒ ì˜ì—­ì´ ë³´ì´ì§€ ì•Šë„ë¡ í•¨
                    window.scrollTo(0, bodyHeight - viewportH - 1);
                }
            }

            // âœ… Android Chrome ìŠ¤í¬ë¡¤ í•¸ë“¤ëŸ¬ (VisualViewport Scroll Only)
            function handleViewportScroll_AndroidChrome(e) {
                // Android Chromeì—ì„œëŠ” visualViewportì˜ offsetTopë§Œ ì‚¬ìš©
                const viewportScrollY = parseInt(e.target.offsetTop);

                // viewport scroll ê°’ì— ë”°ë¼ viewportwrap ì´ë™
                viewportwrap.style.transform = `translateY(${viewportScrollY}px)`;
            }

            // --- 3. ë©”ì¸: í‚¤ë³´ë“œ ê°ì§€ ë° ë·°í¬íŠ¸ ë†’ì´ ì¡°ì • ---

            function viewportResize() {
                if (!window.visualViewport) return;

                const windowInnerHeight = window.innerHeight;
                const viewportHeight = parseInt(visualViewport.height);

                // í‚¤ë³´ë“œ ON ê°ì§€: window.innerHeight > visualViewport.height
                if (windowInnerHeight > viewportHeight) {
                    console.log("Keyboard ON: Adjusting viewportwrap height.");

                    // ë·°í¬íŠ¸ ë†’ì´ë¥¼ í‚¤ë³´ë“œ ì œì™¸ ì˜ì—­ìœ¼ë¡œ ì¬ì§€ì •
                    viewportwrap.style.height = `${viewportHeight}px`;

                    // í”Œë«í¼ì— ë”°ë¼ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë“±ë¡ (ì´ì „ì— ë“±ë¡ë˜ì—ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•´ì œ í›„ ë“±ë¡ ê¶Œì¥)
                    if (currentOS === "iOS") {
                        window.removeEventListener(
                            "scroll",
                            handleWindowScroll_iOS
                        ); // ì¬ë“±ë¡ ë°©ì§€
                        window.addEventListener(
                            "scroll",
                            handleWindowScroll_iOS
                        );
                    } else if (currentOS === "AndroidChrome") {
                        visualViewport.removeEventListener(
                            "scroll",
                            handleViewportScroll_AndroidChrome
                        ); // ì¬ë“±ë¡ ë°©ì§€
                        visualViewport.addEventListener(
                            "scroll",
                            handleViewportScroll_AndroidChrome
                        );
                    }
                } else {
                    // í‚¤ë³´ë“œ OFF
                    console.log("Keyboard OFF: Resetting viewportwrap.");

                    // ì›ë˜ ë†’ì´ë¡œ ë³µì› ë° transform ì´ˆê¸°í™”
                    viewportwrap.style.height = "100%";
                    viewportwrap.style.transform = `translateY(0)`;

                    // í”Œë«í¼ì— ë”°ë¼ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ í•´ì œ
                    if (currentOS === "iOS") {
                        window.removeEventListener(
                            "scroll",
                            handleWindowScroll_iOS
                        );
                    } else if (currentOS === "AndroidChrome") {
                        visualViewport.removeEventListener(
                            "scroll",
                            handleViewportScroll_AndroidChrome
                        );
                    }
                }
            }

            // ğŸš€ ì´ˆê¸° ì‹¤í–‰ ë° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            if (window.visualViewport) {
                visualViewport.addEventListener("resize", viewportResize);
                // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ í™•ì¸ ë° ì ìš©
                viewportResize();
            } else {
                console.warn(
                    "VisualViewport API is not supported in this environment."
                );
            }
        </script>
    </body>
</html>
